<layout name="layout" />
<style>
    .material-list li{
        list-style:none;
        display: inline-block;
        margin-right: 20px;
    }
    #parameter-list li{
        list-style:none;
        display: inline-block;
        margin-right: 20px;
    }
    #formula-list li{
        list-style:none;
        margin-right: 20px;
        margin-bottom: 10px;
    }
    #install-list li{
        list-style:none;
        margin-right: 20px;
    }
</style>
<div class="main-div">
    <form method="post" action="__SELF__"enctype="multipart/form-data" >
        <table cellspacing="1" cellpadding="3" width="100%">
            <tr>
                <td class="label">模型名称</td>
                <td>
                    <input type="text" name="model_name" maxlength="60" />
                    <span class="require-field">*</span>
                </td>
            </tr>
            <tr>
                <td class="label">模型分类：</td>
                <td >
                    <select name="model_cate">
                        <option value="1">柜体</option>
                        <option value="2">饰面</option>
                        <option value="3">门</option>
                    </select>
                    <span class="require-field">*</span>
                </td>
            </tr>
            <tr>
                <td class="label">模型图：</td>
                <td >
                    <input type="file" name="img_src" accept="image/*" >
                </td>
            </tr>
            <tr>
                <td class="label">涉及材料类：</td>
                <td id="material">
                    <div>
                        <input type="button" value="添加一个材料类" onclick="addMaterCat()">
                    </div>
                    <!--<div id="material-list">
                        <a href="javascript:void(0)" onclick="delMaterial(this)">[删除此材料]</a>
                        <input type="text" name="material-price[1][]" placeholder="价格参数如p1" style="width: 80px;">
                        <input type="text" name="material-name[1][]" placeholder="材料类名称" style="width: 80px;">
                        <li>
                            <a href="javascript:void(0)" onclick="addMaterial(this)">[+]</a>
                            <select name="material-val[1][]">
                                <option value="">请选择...</option>
                                <?php foreach($catData as $k => $v): ?>
                                <?php echo '<option value="'.$v['id'].'">'.str_repeat('-',4*$v['level']).$v['name'].'</option>'; ?>
                                <?php endforeach; ?>
                            </select>
                        </li>
                    </div>-->
                </td>
            </tr>
            <tr>
                <td class="label">所需参数：</td>
                <td id="parameter-list">
                    <li>
                        <a href="javascript:void(0)" onclick="addParameter(this)">[+]</a><input type="text" name="parameter[]" style="width: 80px;">
                    </li>
                </td>
            </tr>
            <tr>
                <td class="label">计价公式：</td>
                <td id="formula-list">
                    <li>
                        <a href="javascript:void(0)" onclick="addFormula(this)">[+]</a>
                        <input type="text" name="formula-name[]" placeholder="计价名称" style="width: 80px;">
                        <input type="text" name="formula-num[]" placeholder="计价数量" style="width: 200px;">
                        <input type="text" name="formula-price[]" placeholder="计价单价" style="width: 80px;">
                        <input type="text" name="formula-unit[]" placeholder="计价单位" style="width: 80px;">
                    </li>
                </td>
            </tr>
            <tr>
                <td class="label">推荐排序：</td>
                <td>
                    <input type="text" name="sort_id" size="5" value="100"/>
                </td>
            </tr>
            <tr>
                <td class="label">是否显示：</td>
                <td>
                    <input type="radio" name="is_index" value="1" checked="checked"/> 是
                    <input type="radio" name="is_index" value="0"/> 否
                </td>
            </tr>
            <tr>
                <td colspan="2" align="center"><br />
                    <input type="submit" class="button" value=" 确定 " />
                    <input type="reset" class="button" value=" 重置 " />
                </td>
            </tr>
        </table>
    </form>
</div>
<script>
    function addMaterial(a) {
        let li = $(a).parent();
        var sort = $(a).attr('sort');
        var qqq = '#material-list'+sort;
        if($(a).text() == '[+]'){
            var newLi = li.clone();
            console.log(newLi);
            newLi.find('a').text('[-]');
            newLi.find('select').val('');
            $(qqq).append(newLi);
        }else{
            li.remove();
        }
    }
    function addParameter(a) {
        let li = $(a).parent();
        if($(a).text() == '[+]'){
            var newLi = li.clone();
            newLi.find('a').text('[-]');
            newLi.find('input').val('');
            $('#parameter-list').append(newLi);
        }else{
            li.remove();
        }
    }
    function addFormula(a) {
        let li = $(a).parent();
        if($(a).text() == '[+]'){
            var newLi = li.clone();
            newLi.find('a').text('[-]');
            newLi.find('input').val('');
            $('#formula-list').append(newLi);
        }else{
            li.remove();
        }
    }
    function delMaterial(a) {
        let div = $(a).parent();
        div.remove();
    }
    index = 0;
    function addMaterCat() {
        index = index + 1;
        var catData = <?php echo json_encode($catData);?>;
        var div = '<div id="material-list'+index+'" class="material-list">';
            div += '<a href="javascript:void(0)" onclick="delMaterial(this)">[删除此材料]</a>';
            div += '<input type="text" name="material-price['+index+']" placeholder="价格参数如p1" style="width: 80px;margin-right: 5px;">';
            div += '<input type="text" name="material-name['+index+']" placeholder="材料类名称" style="width: 80px;margin-right: 5px;">';
            div += '<li> <a href="javascript:void(0)" sort="'+index+'" onclick="addMaterial(this)">[+]</a>';
            div += '<select name="material-val['+index+'][]">';
            div += '<option value="">请选择...</option>';
        $(catData).each(function(k,v){
            console.log(v.name);
            div += '<option value="'+v.id+'">'+repeat("-",2*v.level)+v.name+'</option>';
        });
            div += '</select> </li>';
            div += '</div>';
        $('#material').append(div);
    }
    function repeat(str, num){
        return new Array( num + 1 ).join( str );
    }
</script>

